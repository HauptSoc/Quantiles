---
title: "Quantiles and Distributions"
subtitle: "A short Primer"
author: "<large>Andreas Haupt & Sebastian Wenz</large>"
institute: "<small>KIT & GESIS</small>" # uncomment to include
# date: "`r format(Sys.Date(), '%A, %e %B, %Y')`" # uncomment to include
output:
  xaringan::moon_reader:
    css: 
      - "default"
      - "css/iheid-xaringan-style.css" # You need to change this file path to css/...
      - "https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      - "ninjutsu"
    chakra: "https://remarkjs.com/downloads/remark-latest.min.js"
    # if you want to work offline, run the following command...
    # xaringan::summon_remark()
    # ...and then comment out lines 10-13 and uncomment lines 14-15:
    # lib_dir: libs
    # chakra: libs/remark-latest.min.js # For offline
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      beforeInit: "js/macros.js"
      countIncrementalSlides: false
      slideNumberFormat: |
        <div class="progress-bar-container">
          <div class="progress-bar" style="width: calc(%current% / %total% * 100%);">
          </div>
        </div>`
---
class: center, middle

# This is a very first test

## for us to see if this setup is usable

```{r setup, include=FALSE}
# don't mind this code chunk, it just sets up a few things for the rest
# it doesn't appear, because the include argument above is FALSE...
options(htmltools.dir.version = FALSE, servr.daemon = TRUE)
knitr::opts_chunk$set(cache=TRUE, autodep = TRUE, fig.retina = 3, message = FALSE, warning = FALSE)
old <- ggplot2::theme_set(iheiddown::theme_iheid())
```

```{r, load_refs, include=FALSE, cache=FALSE}
# Initializes the bibliography
library(RefManageR)
BibOptions(check.entries = FALSE,
           bib.style = "authoryear", # Bibliography style
           max.names = 3, # Max author names displayed in bibliography
           sorting = "nyt", #Name, year, title sorting
           cite.style = "authoryear", # citation style
           style = "markdown",
           hyperlink = FALSE,
           dashed = FALSE)
myBib <- ReadBib("bib/myBibClass1.bib", check = FALSE)
# Note: don't forget to clear the knitr cache to account for changes in the
# bibliography.
```

---
## Who we are: Andreas 

.pull-left[
.polaroid[![](https://www.andreas-haupt.com/authors/admin/Avatar_hu8162f7db23abce87a0df05f52210fa90_84431_270x270_fill_q75_lanczos_center.jpg)]

Andreas Haupt
]

.pull-right[
Sociologist and Assistant Professor (Akad. Oberrat) at the Karlsruhe Institut of Technology. 

* Studies income and wage distributions 
* Gender inequalities
* Poverty
]


---
## Who we are: Sebastian 

.pull-left[
.polaroid[![](https://gris.gesis.org/files/photos/922.jpg)]


Sebastian Wenz
]

.pull-right[
Sociologist and Deputy head of team "Knowledge Exchange and Outreach" 

* Sociology of education
* Discrimination
* Causal inference
]

---
class: show-only-last-code-result
## Distribution Functions

**Distribution functions** are commonly defined as: 


$$F_X(x)=P(X \leq x)$$ 

The left hand side represents the probability, that an element of X takes a value less or equal to x. 

.center[
```{r, echo=FALSE, fig.height=6}

# create sample data 
sample_Data = rnorm(500) 
  
# calculate CDF  
CDF <- ecdf(sample_Data ) 
# draw the cdf plot 
plot( CDF , main="Cummulative Distribution")
```
]

---
## Inverse CDFs
.center[
```{r, echo=FALSE, out.width="35%", fig.cap="The relation between the CDF and inverse CDF"}
knitr::include_graphics("images/cdf-invcdf2.jpg")
```
]

---
## Partitioning a distribution

We can chop a distribution in different parts. Tradition has it that according to the number of parts, we call the parts differently. 

```{r table2, echo=FALSE, message=FALSE, warnings=FALSE, results='asis'}
tabl <- "
| Number of parts               | Term        |
|--------------------------|-------------|
| 4                        | Quartile    |
| 5                        | Quintile    |
| 10                       | Decile      |
| 100 (from 1 to 100)      | Percentile  |
| 100 (from 0.01 to 1)     | Quantile    |
"
cat(tabl) # output the table in a format good for HTML/PDF/docx conversion
```

Within this seminar, we will use the terms *Percentile* and *Quantile* interchangeably. 

---
## Parts of distributions and limits of parts of distributions

.pull-left[
```{r, echo=FALSE, out.width="35%", fig.cap="The relation between the CDF and inverse CDF"}
library(ggplot2)
library(ggridges)
# Examples of coloring by ecdf or quantiles
ggplot(iris, aes(x = Sepal.Length, y = Species, fill = factor(stat(quantile)))) +
  stat_density_ridges(
    geom = "density_ridges_gradient",
    calc_ecdf = TRUE,
    quantiles = 5
  ) +
  scale_fill_viridis_d(name = "Quintiles") +
  theme_ridges()
#> Picking joint bandwidth of 0.181
```
]

.pull-right[ Sometimes people refer to quantiles or deciles as intervals within a distribution, like "households within lower decile of the distribution". 

Keep in mind that quantiles as we have defined them are separators of such intervals. 
]


---
## Quantiles -- formal definition
Quantiles define thresholds between regions within the distribution. They separate regions with lower or equal cumulative density (or probability) $p$ from those with higher ones. Because the CDF and the PDF are linked through the inverse function $F^{-1}$, we can calculate the value of any threshold using: 

$$Q = F^{-1}(p)$$

A second way to define quantiles is to use the smallest value for $x$ that exceeds the cumulative density separated by the quantile:

$$Q(p) \,=\,\inf\left\{ x\in \mathbb{R} : p \geq F(x) \right\}$$

Software packages differ, which approach they use for estimating descriptive quantiles. This can matter if you have only sparse data. 

---
## Estimation of quantiles in Stata for description 

* *summarize, detail* and *tabstat* gives you also a (limited) set of quantiles.
* The commands *xtile* and *pctile* estimate descriptive quantiles, which rely on the the idea of the second equation.
* The command *egen(new_var), cut(var) n()* creates a new variable "new_var" with "n()" cutpoints.  

---
# References

```{r refs, echo=FALSE, results="asis"}
RefManageR::PrintBibliography(myBib)
```
